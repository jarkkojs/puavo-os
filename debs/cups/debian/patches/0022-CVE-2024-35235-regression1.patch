commit 7adb50839710f908af11a2f0a7d4b7aa506af2b8
Author: Michael R Sweet <msweet@msweet.org>
Date:   Fri Jun 14 15:09:41 2024 -0400

    Don't abort early if there are no listen sockets after loading cupsd.conf (Issue #985)

Index: cups-2.3.3op2/scheduler/conf.c
===================================================================
--- cups-2.3.3op2.orig/scheduler/conf.c	2024-06-26 14:29:33.834864098 +0200
+++ cups-2.3.3op2/scheduler/conf.c	2024-06-26 14:29:33.834864098 +0200
@@ -1063,7 +1063,7 @@
   * as an error and exit!
   */
 
-  if (cupsArrayCount(Listeners) == 0)
+  if (cupsArrayCount(Listeners) == 0 && !OnDemand)
   {
    /*
     * No listeners!
Index: cups-2.3.3op2/scheduler/main.c
===================================================================
--- cups-2.3.3op2.orig/scheduler/main.c	2024-06-26 14:29:33.834864098 +0200
+++ cups-2.3.3op2/scheduler/main.c	2024-06-26 14:29:33.834864098 +0200
@@ -2040,6 +2040,23 @@
     service_add_listener(fd, 0);
   }
 #endif /* HAVE_LAUNCHD */
+
+  if (cupsArrayCount(Listeners) == 0)
+  {
+   /*
+    * No listeners!
+    */
+
+    cupsdLogMessage(CUPSD_LOG_EMERG,
+                    "No valid Listen or Port lines were found in the "
+		    "configuration file.");
+
+   /*
+    * Commit suicide...
+    */
+
+    cupsdEndProcess(getpid(), 0);
+  }
 }
 
 
